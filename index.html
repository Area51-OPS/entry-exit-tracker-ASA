<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Entry/Exit Tracker</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
  /* Consolidated styles to avoid duplicates and stray braces */
  :root {
	--bg-dark: #3c3c3c;
	--panel: rgba(0, 30, 60, 0.9);
	--accent: #0b66d1;
	--accent-hover: #0e7ff3;
	--button-dark: #2f2f2f;
	--text-on-dark: #ffffff;
	--input-bg: #ffffff;
	--input-text: #000000;
  }

  html, body {
	height: 100%;
	margin: 0;
  }

  body {
	font-family: Arial, sans-serif;
	padding: 20px;
	background-color: var(--bg-dark);
	color: var(--text-on-dark);
  }

  .blue-screen {
	background-color: var(--panel);
	color: var(--text-on-dark);
	padding: 30px;
	border-radius: 8px;
	margin-bottom: 16px;
  }

  .button-group {
	display: flex;
	gap: 10px;
	flex-wrap: wrap;
	margin-top: 20px;
  }

  .button-group button {
	flex: 1 1 30%;
	padding: 12px;
	font-size: 16px;
	border: none;
	border-radius: 6px;
	background-color: var(--accent);
	color: var(--text-on-dark);
	font-weight: 700;
	cursor: pointer;
	transition: background-color 0.2s ease;
  }

  .button-group button.logs-btn {
	flex: 1 1 100%;
	margin-top: 10px;
	background-color: var(--button-dark);
  }

  .button-group button:hover {
	background-color: var(--accent-hover);
  }

  .button-group button.secondary {
	background-color: var(--button-dark);
  }

  input[type="text"], input[type="password"] {
	display: block;
	margin: 10px 0;
	padding: 10px;
	font-size: 16px;
	width: 100%;
	max-width: 400px;
	border-radius: 4px;
	border: 1px solid #ccc;
	background-color: var(--input-bg);
	color: var(--input-text);
	box-sizing: border-box;
  }

  #timeOutput {
	font-weight: bold;
	margin: 10px 0;
	color: var(--text-on-dark);
  }

  /* New style for the password input section */
  .password-control {
	margin-top: 20px;
	padding-top: 10px;
	border-top: 1px solid rgba(255, 255, 255, 0.2);
  }

  .password-control button {
	background-color: var(--button-dark);
	flex: 1 1 100%;
  }

  .logs-control-buttons {
	display: flex;
	gap: 10px;
	margin-bottom: 15px;
  }

  .logs-control-buttons button {
	flex: 1;
	padding: 12px;
  }

  /* Logs container style */
  #logsTableContainer {
	max-height: 400px;
	overflow-y: auto;
	background: #fff;
	color: #000;
	padding: 10px;
	border-radius: 8px;
  }

  table {
	width: 100%;
	border-collapse: collapse;
	text-align: left;
  }

  table th, table td {
	padding: 6px;
	border: 1px solid #ddd;
	color: var(--input-text); /* Ensure table text is readable */
  }
</style>
</head>
<body>

<div id="screen1" class="blue-screen">
Â  <h2>Select Category</h2>
Â  <div class="button-group">
Â  Â  <button onclick="selectCategory('Student')">1. Student</button>
Â  Â  <button onclick="selectCategory('Staff')">2. Staff</button>
Â  Â  <button onclick="selectCategory('Management')">3. Management</button>
Â  </div>
</div>

<div id="screen1-5" class="blue-screen" style="display: none;">
Â  <h2>Select Staff TypeÂ Â Â </h2>
Â  <div class="button-group">
Â  Â  <button onclick="selectStaffType('Teaching')">Teaching Staff</button>
Â  Â  <button onclick="selectStaffType('Non-Teaching')">Non-Teaching Staff</button>
Â  Â  <button onclick="goBackToScreen1()">Back</button>
Â  </div>
</div>

<div id="screen2" class="blue-screen" style="display: none;">
Â  <h2 id="screen2-title">Select Movement</h2>
Â  <div class="button-group">
Â  Â  <button onclick="selectMovement('Coming')">Coming</button>
Â  Â  <button onclick="selectMovement('Going')">Going</button>
Â  Â  <button onclick="goBackToStaffOrMain()">Back</button>
Â  </div>
Â  Â  Â  Â  <button id="logsControlBtn" onclick="showLogsControlScreen()" class="logs-btn" style="display: none;">View/Export Logs</button>
</div>

<div id="screen3" class="blue-screen" style="display: none;">
Â  <h2 id="screen3-title">Movement Log</h2>
Â  <input type="text" id="nameInput" placeholder="Enter Name" oninput="onNameChanged()" />
Â  <input type="text" id="classInput" placeholder="Enter Department" />
Â  <div id="timeOutput"></div>
Â  <div class="button-group">
Â  Â  <button id="logEntryBtn" onclick="logEntry()" disabled>Log Entry</button>
Â  Â  <button onclick="goBackToScreen2()">Back</button>
Â  </div>
</div>

<div id="screenLogsControl" class="blue-screen" style="display: none;">
Â  <h2>Log Access Controls</h2>

Â  Â  <div class="logs-control-buttons">
Â  Â  <button id="exportBtn" onclick="exportToExcel()" disabled>Export to Excel</button>
Â  Â  <button id="viewLogsBtn" onclick="viewLogs()" disabled>View Logs Table</button>
Â  </div>

Â  Â  <div class="password-control">
Â  Â  <h4>ðŸ”’ Access Password</h4>
Â  Â  <input type="password" id="logPasswordInput" placeholder="Enter Password to Access Logs" />
Â  Â  <div class="button-group">
Â  Â  Â  <button onclick="checkAndGrantLogAccess()">Access Logs</button>
Â  Â  Â  <button onclick="changePasswordFlow()" class="secondary" id="setChangePasswordBtn">Set/Change Password</button>
Â  Â  </div>
Â  </div>
Â  <div class="button-group">
Â  Â  <button onclick="goBackToScreen2()">Back</button>
Â  </div>
</div>


<div id="screenLogs" class="blue-screen" style="display: none;">
Â  <h2>Movement Logs</h2>
Â  <div id="logsTableContainer"></div>

Â  <div class="button-group" style="margin-top: 20px;">
Â  Â  <button id="printBtn" onclick="printLogs()" style="display:none;">Print</button>
Â  Â  <button onclick="goBackFromLogs()">Back</button>
Â  </div>
</div>

<script>
/* -------------- START OF JS CODE -------------- */
const DATA_KEY = 'movementTrackerData';
const DATE_KEY = 'movementTrackerDate';
const PASSWORD_KEY = 'logAccessPassword'; // Key for stored password

let dataEntries = [];
const nameToClassMap = {};
let autoID = 1;
let currentExportDate = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
let logAccessGranted = false; // Tracks successful password entry in the current session

window.currentCategory = '';
window.currentStaffType = '';
window.currentMovement = '';

// Helper to enable/disable the access buttons
function toggleAccessButtons(enable) {
Â  Â  const exportBtn = document.getElementById('exportBtn');
Â  Â  const viewBtn = document.getElementById('viewLogsBtn');
Â  Â  if (exportBtn) exportBtn.disabled = !enable;
Â  Â  if (viewBtn) viewBtn.disabled = !enable;
}

function getFormattedDateTime() {
Â  const now = new Date();
Â  const options = {
Â  Â  year: 'numeric',
Â  Â  month: '2-digit',
Â  Â  day: '2-digit',
Â  Â  hour: '2-digit',
Â  Â  minute: '2-digit',
Â  Â  second: '2-digit',
Â  Â  hour12: true,
Â  };
Â  return now.toLocaleString('en-US', options);
}

function saveData() {
Â  try {
Â  Â  localStorage.setItem(DATA_KEY, JSON.stringify(dataEntries));
Â  } catch (e) {
Â  Â  console.error('Failed to save data to localStorage', e);
Â  }
}

function clearLogs(startNewDay = false) {
Â  if (startNewDay || confirm("Are you sure you want to clear all logs? This action is irreversible unless you have exported the data.")) {
Â  Â  dataEntries = [];
Â  Â  autoID = 1;
Â  Â  localStorage.removeItem(DATA_KEY);

Â  Â  if (startNewDay) {
const today = new Date().toISOString().split('T')[0];
// Ensure all buttons use the same blue accent (override any inline/other styles)
const root = document.documentElement;
root.style.setProperty('--accent', '#0b66d1');
root.style.setProperty('--accent-hover', '#0e7ff3');
root.style.setProperty('--button-dark', '#0b66d1');

const accentColor = getComputedStyle(root).getPropertyValue('--accent').trim();
const textOnDark = getComputedStyle(root).getPropertyValue('--text-on-dark').trim() || '#ffffff';

document.querySelectorAll('button').forEach(btn => {
	btn.style.backgroundColor = accentColor;
	btn.style.color = textOnDark;
	btn.style.border = 'none';
	btn.style.fontWeight = '700';
	btn.style.cursor = 'pointer';
});
Â  Â  Â  localStorage.setItem(DATE_KEY, today);
Â  Â  Â  currentExportDate = today;
Â  Â  Â  location.reload();
Â  Â  } else {
Â  Â  Â  alert('Logs cleared successfully.');
Â  Â  }
Â  }
}

function initializeTracker() {
  const savedData = localStorage.getItem(DATA_KEY);
  const savedDate = localStorage.getItem(DATE_KEY);
  const today = new Date().toISOString().split('T')[0];

  // RESET stored password on load (clears any previously saved password)
  if (localStorage.getItem(PASSWORD_KEY)) {
	localStorage.removeItem(PASSWORD_KEY);
	console.log('Stored log access password has been reset.');
  }

  if (savedData && savedDate && savedDate !== today) {
	const parsedData = JSON.parse(savedData);
	dataEntries = parsedData;
	currentExportDate = savedDate;
	alert(`A new day has begun! Please export the logs from ${savedDate} before logging new entries.`);
  } else if (savedData && savedDate === today) {
	const parsedData = JSON.parse(savedData);
	dataEntries = parsedData;
	const maxId = dataEntries.reduce((max, entry) => Math.max(max, entry.ID || 0), 0);
	autoID = maxId + 1;
	console.log(`Continuing log for ${today}. ${dataEntries.length} entries loaded.`);
	currentExportDate = today;
  } else {
	localStorage.setItem(DATE_KEY, today);
	currentExportDate = today;
  }
  
  // Ensure all controls start hidden/disabled
  document.getElementById('logsControlBtn').style.display = 'none';
  toggleAccessButtons(false);
  logAccessGranted = false;

  // Reflect password reset in the UI
  if (typeof updatePasswordUI === 'function') updatePasswordUI();
}

initializeTracker();


// ðŸ”’ PASSWORD FUNCTIONS ðŸ”’

function updatePasswordUI() {
Â  Â  const setChangeBtn = document.getElementById('setChangePasswordBtn');
Â  Â  const pwdInput = document.getElementById('logPasswordInput');
Â  Â  const isSet = !!localStorage.getItem(PASSWORD_KEY);

Â  Â  if (setChangeBtn) {
Â  Â  Â  Â  setChangeBtn.textContent = isSet ? "Change Password" : "Set Password";
Â  Â  }
Â  Â  if (pwdInput) {
Â  Â  Â  Â  pwdInput.placeholder = logAccessGranted ? "Access Granted" : (isSet ? "Enter Password to Access Logs" : "Set a Password (4+ chars)");
Â  Â  Â  Â  pwdInput.disabled = logAccessGranted;
Â  Â  Â  Â  pwdInput.type = logAccessGranted ? 'text' : 'password'; // Visually show access is granted
Â  Â  }
}

function checkAndGrantLogAccess() {
Â  Â  const storedPassword = localStorage.getItem(PASSWORD_KEY);
Â  Â  const passwordInput = document.getElementById('logPasswordInput');
Â  Â  const attempt = (passwordInput.value || '').trim();

Â  Â  // Case 1: Already granted
Â  Â  if (logAccessGranted) {
Â  Â  Â  Â  return true;
Â  Â  }

Â  Â  // Case 2: No password set, grant access (but user must set one for security)
Â  Â  if (!storedPassword) {
Â  Â  Â  Â  alert("No password set. Access granted for now, but please set one using the 'Set Password' button for security.");
Â  Â  Â  Â  logAccessGranted = true;
Â  Â  Â  Â  toggleAccessButtons(true);
Â  Â  Â  Â  updatePasswordUI();
Â  Â  Â  Â  passwordInput.value = '';
Â  Â  Â  Â  return true;
Â  Â  }

Â  Â  // Case 3: Password check
Â  Â  if (attempt === storedPassword) {
Â  Â  Â  Â  logAccessGranted = true;
Â  Â  Â  Â  toggleAccessButtons(true);
Â  Â  Â  Â  updatePasswordUI();
Â  Â  Â  Â  passwordInput.value = '';
Â  Â  Â  Â  alert("Access Granted.");
Â  Â  Â  Â  return true;
Â  Â  } else {
Â  Â  Â  Â  alert("Incorrect Password.");
Â  Â  Â  Â  passwordInput.value = '';
Â  Â  Â  Â  passwordInput.focus();
Â  Â  Â  Â  return false;
Â  Â  }
}

function changePasswordFlow() {
Â  Â  const stored = localStorage.getItem(PASSWORD_KEY);
Â  Â  const passwordInput = document.getElementById('logPasswordInput');

Â  Â  // Step 1: Check Current Password (if set)
Â  Â  if (stored) {
Â  Â  Â  Â  const current = prompt("Enter current password to change:");
Â  Â  Â  Â  if (current === null) return; // cancelled
Â  Â  Â  Â  if (current !== stored) {
Â  Â  Â  Â  Â  Â  alert("Incorrect current password.");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // Step 2: Get New Password
Â  Â  const newPassword = prompt("Enter new password (4+ characters):");
Â  Â  if (newPassword === null) return; // cancelled
Â  Â  const trimmedPassword = newPassword.trim();

Â  Â  if (trimmedPassword.length < 4) {
Â  Â  Â  Â  alert("New password must be at least 4 characters long.");
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  // Step 3: Save and Reset Access
Â  Â  localStorage.setItem(PASSWORD_KEY, trimmedPassword);
Â  Â  logAccessGranted = false;
Â  Â  toggleAccessButtons(false);
Â  Â  if (passwordInput) passwordInput.value = '';
Â  Â  alert(stored ? "Password changed successfully." : "Password set successfully.");
Â  Â  updatePasswordUI();
}

// ---------------------------------------------


function selectCategory(category) {
Â  window.currentCategory = category;
Â  const logsBtn = document.getElementById('logsControlBtn');

Â  // ðŸ›‘ ACCESS CONTROL: Students CANNOT see the Logs button
Â  if (category === 'Student') {
Â  Â  logsBtn.style.display = 'none';
Â  Â  document.getElementById('screen1').style.display = 'none';
Â  Â  document.getElementById('screen2').style.display = 'block'; // Go straight to Movement
Â  } else {
Â  Â  // Staff/Management: Show the Logs button on the Movement screen
Â  Â  logsBtn.style.display = 'block';
Â  Â  if (category === 'Staff') {
Â  Â  Â  document.getElementById('screen1').style.display = 'none';
Â  Â  Â  document.getElementById('screen1-5').style.display = 'block'; // Go to Staff type selection
Â  Â  } else {
Â  Â  Â  document.getElementById('screen1').style.display = 'none';
Â  Â  Â  document.getElementById('screen2').style.display = 'block'; // Go to Movement selection
Â  Â  }
Â  }
}

function selectStaffType(type) {
Â  window.currentStaffType = type;
Â  document.getElementById('screen1-5').style.display = 'none';
Â  document.getElementById('screen2').style.display = 'block';
}

function showLogsControlScreen() {
Â  // ðŸ›‘ ACCESS CONTROL: Ensure non-Staff/Management cannot access (redundant check)
Â  if (window.currentCategory === 'Student') {
Â  Â  return alert("Access Denied. Only Staff and Management can view logs.");
Â  }

Â  // Hide all other screens
Â  document.getElementById('screen1').style.display = 'none';
Â  document.getElementById('screen1-5').style.display = 'none';
Â  document.getElementById('screen2').style.display = 'none';
Â  document.getElementById('screen3').style.display = 'none';
Â  document.getElementById('screenLogs').style.display = 'none';
Â  
Â  // Show the new control screen
Â  document.getElementById('screenLogsControl').style.display = 'block';

Â  // Update the UI state of the password section
Â  toggleAccessButtons(logAccessGranted);
Â  updatePasswordUI();
Â  
Â  if (!logAccessGranted) {
Â  Â  document.getElementById('logPasswordInput').focus();
Â  }
}

function selectMovement(movement) {
Â  window.currentMovement = movement;
Â  document.getElementById('screen2').style.display = 'none';
Â  document.getElementById('screen3').style.display = 'block';
Â  document.getElementById('screen3-title').textContent = `${movement} Log`;
Â  updateCurrentTime();

Â  const classInput = document.getElementById('classInput');
Â  if (window.currentCategory === 'Student') {
Â  Â  classInput.placeholder = 'Enter Class';
Â  } else if (window.currentCategory === 'Staff') {
Â  Â  classInput.placeholder = window.currentStaffType === 'Teaching' ? 'Enter Class' : 'Enter Department';
Â  } else if (window.currentCategory === 'Management') {
Â  Â  classInput.placeholder = 'Enter Position';
Â  }

Â  document.getElementById('nameInput').value = '';
Â  classInput.value = '';
Â  classInput.disabled = false;
Â  document.getElementById('logEntryBtn').disabled = true;
}

function goBackToScreen1() {
Â  document.getElementById('screen1-5').style.display = 'none';
Â  document.getElementById('screen1').style.display = 'block';
Â  document.getElementById('logsControlBtn').style.display = 'none';
}

function goBackToStaffOrMain() {
Â  document.getElementById('screen2').style.display = 'none';
Â  document.getElementById('screenLogsControl').style.display = 'none'; // Added to handle back from logs control

Â  if (window.currentCategory === 'Staff') {
Â  Â  document.getElementById('screen1-5').style.display = 'block';
Â  } else {
Â  Â  document.getElementById('screen1').style.display = 'block';
Â  Â  document.getElementById('logsControlBtn').style.display = 'none';
Â  }
}

function goBackToScreen2() {
Â  document.getElementById('screen3').style.display = 'none';
Â  document.getElementById('screenLogsControl').style.display = 'none'; // Added to handle back from logs control
Â  document.getElementById('screen2').style.display = 'block';
}

function logEntry() {
Â  const name = document.getElementById('nameInput').value.trim();
Â  const classVal = document.getElementById('classInput').value.trim();
Â  const time = document.getElementById('timeOutput').textContent.trim();

Â  const today = new Date().toISOString().split('T')[0];
Â  if (currentExportDate !== today) {
Â  Â  return alert("Cannot log new entry. Please export the previous day's logs first.");
Â  }

Â  if (!name) return alert('Please enter a name before logging.');

Â  const key = name.toLowerCase();
Â  let finalClassVal = classVal || nameToClassMap[key];

Â  if (!finalClassVal && !nameToClassMap[key]) {
Â  Â  return alert('Please enter class, department, or position for this new name.');
Â  }

Â  if (!nameToClassMap[key] && finalClassVal) {
Â  Â  nameToClassMap[key] = finalClassVal;
Â  }

Â  const category = window.currentCategory || 'Student';
Â  const staffType = window.currentStaffType || '';
Â  const movement = window.currentMovement || 'Entered';

Â  let categoryField = 'Department';
Â  if (category === 'Student' || (category === 'Staff' && staffType === 'Teaching')) {
Â  Â  categoryField = 'Class';
Â  } else if (category === 'Management') {
Â  Â  categoryField = 'Position';
Â  }

Â  const entry = {
Â  Â  ID: autoID++,
Â  Â  Name: name,
Â  Â  Category: category,
Â  Â  StaffType: staffType,
Â  Â  Movement: movement,
Â  Â  Time: time || getFormattedDateTime()
Â  };
Â  // attach the appropriate field
Â  entry[categoryField] = nameToClassMap[key] || finalClassVal || '';

Â  dataEntries.push(entry);
Â  saveData();
Â  
Â  // After logging an entry, ensure the Logs button is visible, but only if not a Student
Â  if (window.currentCategory !== 'Student') {
Â  Â  document.getElementById('logsControlBtn').style.display = 'block';
Â  }

Â  document.getElementById('nameInput').value = '';
Â  document.getElementById('classInput').value = '';
Â  document.getElementById('classInput').disabled = false;
Â  document.getElementById('timeOutput').textContent = '';
Â  document.getElementById('logEntryBtn').disabled = true;

Â  alert('Entry logged successfully.');
}

/**
Â * Displays logs on a separate screen.
Â */
function viewLogs() {
Â  // This function is only called if logAccessGranted is true, but we keep the student check
Â  if (window.currentCategory === 'Student') {
Â  Â  return alert("Access Denied. Students are not authorized to view logs.");
Â  }

Â  document.getElementById('screenLogsControl').style.display = 'none';
Â  const logsContainer = document.getElementById('logsTableContainer');
Â  document.getElementById('screenLogs').style.display = 'block';

Â  if (dataEntries.length === 0) {
Â  Â  logsContainer.innerHTML = '<p>No entries logged yet.</p>';
Â  Â  return;
Â  }

Â  let html = '<table>';
Â  html += '<tr><th>ID</th><th>Name</th><th>Category</th><th>Staff Type</th><th>Class/Dept/Pos</th><th>Movement</th><th>Time</th></tr>';

Â  for (const e of dataEntries) {
Â  Â  const info = e.Class || e.Department || e.Position || '';
Â  Â  html += `<tr>
Â  Â  Â  <td>${e.ID}</td>
Â  Â  Â  <td>${e.Name}</td>
Â  Â  Â  <td>${e.Category}</td>
Â  Â  Â  <td>${e.StaffType || '-'}</td>
Â  Â  Â  <td>${info}</td>
Â  Â  Â  <td>${e.Movement}</td>
Â  Â  Â  <td>${e.Time}</td>
Â  Â  </tr>`;
Â  }

Â  html += '</table>';
Â  logsContainer.innerHTML = html;
}

/**
Â * Logic for going back from the logs table view to the logs control screen.
Â */
function goBackFromLogs() {
Â  document.getElementById('screenLogs').style.display = 'none';
Â  
Â  // Go back to the Logs Control screen
Â  document.getElementById('screenLogsControl').style.display = 'block';
Â  updatePasswordUI();
}

function onNameChanged() {
Â  const name = document.getElementById('nameInput').value.trim().toLowerCase();
Â  const classInput = document.getElementById('classInput');
Â  const logButton = document.getElementById('logEntryBtn');

Â  if (name && nameToClassMap[name]) {
Â  Â  classInput.value = nameToClassMap[name];
Â  Â  classInput.disabled = true;
Â  Â  updateCurrentTime();
Â  Â  logButton.disabled = false;
Â  } else if (name) {
Â  Â  classInput.disabled = false;
Â  Â  updateCurrentTime();
Â  Â  logButton.disabled = false;
Â  } else {
Â  Â  classInput.value = '';
Â  Â  classInput.disabled = false;
Â  Â  document.getElementById('timeOutput').textContent = '';
Â  Â  logButton.disabled = true;
Â  }
}

function updateCurrentTime() {
Â  document.getElementById('timeOutput').textContent = getFormattedDateTime();
}

function exportToExcel() {
Â  // This function is only called if logAccessGranted is true, but we keep the student check
Â  if (window.currentCategory === 'Student') {
Â  Â  return alert("Access Denied. Students are not authorized to export data.");
Â  }

Â  if (dataEntries.length === 0) {
Â  Â  if (localStorage.getItem(DATA_KEY)) {
Â  Â  Â  clearLogs(true);
Â  Â  Â  return;
Â  Â  }
Â  Â  return alert('No data to export.');
Â  }

Â  const studentEntries = dataEntries.filter(e => e.Category === 'Student');
Â  const staffEntries = dataEntries.filter(e => e.Category === 'Staff');
Â  const managementEntries = dataEntries.filter(e => e.Category === 'Management');

Â  const workbook = XLSX.utils.book_new();

Â  if (studentEntries.length) XLSX.utils.book_append_sheet(workbook, XLSX.utils.json_to_sheet(studentEntries), 'Students');
Â  if (staffEntries.length) XLSX.utils.book_append_sheet(workbook, XLSX.utils.json_to_sheet(staffEntries), 'Staff');
Â  if (managementEntries.length) XLSX.utils.book_append_sheet(workbook, XLSX.utils.json_to_sheet(managementEntries), 'Management');

Â  const filename = `Movement_Logs_${currentExportDate}.xlsx`;
Â  XLSX.writeFile(workbook, filename);
Â  alert(`Excel file saved: ${filename}`);

Â  // If exporting old-day data, clear and start fresh
Â  const today = new Date().toISOString().split('T')[0];
Â  if (currentExportDate !== today) {
Â  Â  clearLogs(true);
Â  }
}
function selectCategory(category) {
  window.currentCategory = category;
  const logsBtn = document.getElementById('logsControlBtn');

  // Students and all Staff cannot see the Logs button
  if (category === 'Student' || category === 'Staff') {
    logsBtn.style.display = 'none';
  } else {
    // Management: Show the Logs button
    logsBtn.style.display = 'block';
  }

  if (category === 'Student') {
    document.getElementById('screen1').style.display = 'none';
    document.getElementById('screen2').style.display = 'block'; // Go straight to Movement
  } else if (category === 'Staff') {
    document.getElementById('screen1').style.display = 'none';
    document.getElementById('screen1-5').style.display = 'block'; // Staff type selection
  } else if (category === 'Management') {
    document.getElementById('screen1').style.display = 'none';
    document.getElementById('screen2').style.display = 'block'; // Movement selection
  }
}


/* -------------- END OF JS CODE -------------- */
</script>

</body>
</html>